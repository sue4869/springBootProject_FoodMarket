<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>findPw02</title>
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js" ></script>
</head>
<link rel="stylesheet" href="/css/findPw02.css">
<script>
    $(function () {

        /**카테고리영역**/
        $(".submenu").hide();

        $(".catagory").mouseover(function () {
            $(".submenu").slideDown();
        });

        $(".submenu").mouseleave(function () {
            $(".submenu").hide();
        });

        /**검색영역**/
        $(".search input").hide();
        $(".search button").hide();

        $(".searchIcon").mouseover(function () {
            $(".search input").slideDown();
            $(".search button").slideDown();
        });

    });
</script>
<body>
<div id="sidebar">
    <div id="menu_head">
        <li id="head_list">
            <div class="logo"><p> Mega market</p></div>
            <div class="search_area"><button class="searchIcon"><img class = "img_searchIcon" src ="/images/search.png" width="50px" height="50px" ></button></div>
            <form action="/productSearch" method="get">
                <div class="search">
                    <input type="text" placeholder="검색어를 입력해주세요." class="searchInput" name="searchText">
                    <div class="btnSearchDiv01">
                        <button type="submit" class="btnSearch" style="width:30px; background-color: white;">
                            <img src="/images/glasses01.png" alt="" class="glasses">
                        </button>
                    </div>
                </div>
            </form>
        </li>
    </div>
    <div id = "menu_profile">
        <li id = "profile_area">
            <div class = "profile_icon"><img src="/images/profile.png" alt="사람 아이콘" width="50px" height="50px"></div>
            <div class="nickname">
                <a href="/loginForm02" class="blind" th:if="${loginCheck} == 'unlogined'" th:text="${login}" id="unlogined" style="text-decoration: none;"></a>
                <!--                <a href="/loginForm02" class="blind" th:if="${loginCheck} == 'unlogined'" th:value="${login}" id="unlogined" style="text-decoration: none;"></a>-->
                <!--<span class = "blind unlogined" th:if="${loginCheck} == 'unlogined'" th:text="${login}"></span>-->
                <span class = "blind logined" th:if="${loginCheck} == 'logined'" th:text="${userName}" id="logined"></span>
            </div>
        </li>
    </div>
    <a th:if="${logoutCheck} == 'logoutCheck'" class="logoutCheck">logout</a>
    <!--    <button th:if="${logoutCheck} == 'logoutCheck'" type="button" class="logoutCheck">logout</button>-->
    <div id = "menu_area">

        <ul role="menu">
            <li class = "myPage">
                <a href= "/myPage" style="text-decoration:none">
                    <!-- 추가-->
                    <img  src="/images/me.png" width="30px" height="30px" th:if="${loginCheck} == 'logined'" ><span th:if="${loginCheck} == 'logined'">마이페이지</span>
                </a>
            </li>
            <li>
                <a href= "/main" style="text-decoration:none">
                    <img src="/images/menu1.png" width="30px" height="30px">홈
                </a>
            </li>
            <li>
                <a href= "/newProduct" style="text-decoration:none">
                    <img src="/images/menu2.png" width="30px" height="30px">신상품
                </a>
            </li>
            <li>
                <a href= "/best" style="text-decoration:none">
                    <img src="/images/menu3.png" width="30px" height="30px">베스트
                </a>
            <li>
            <li>
                <a href= "/event" style="text-decoration:none">
                    <img src="/images/menu4.png" width="30px" height="30px" >이벤트
                </a>
            </li>
            <li class = "catagory" >
                <a href= "#" style="text-decoration:none">
                    <img src="/images/menu5.png" width="30px" height="30px">카테고리
                </a>
            </li>
            <div class = "submenu">
                <li>
                    <a href="/goodList/vegetable" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">채소
                    </a>
                </li>
                <li>
                    <a href="/goodList/fruitrice" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">과일,견과,쌀
                    </a>
                </li>
                <li>
                    <a href="/goodList/fish" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">수산,해산
                    </a>
                </li>
                <li>
                    <a href="/goodList/snackbread" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">베이커리,과자
                    </a>
                </li>
                <li>
                    <a href="/goodList/meat" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">정육,계란
                    </a>
                </li>
                <li>
                    <a href="/goodList/oilnoodle" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">면,양념,오일
                    </a>
                </li>
                <li>
                    <a href="/goodList/drink" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">생수,음료
                    </a>
                </li>
                <li>
                    <a href="/goodList/importantdish" style="text-decoration:none">
                        <img src="/images/circle.png" width="3px" height="3px">메인요리
                    </a>
                </li>
            </div>
            <!-- 추가-->

        </ul>
        <!--        <button type="button" th:if="${logoutCheck} == 'logoutCheck'" class="logoutCheck">logout</button>-->
    </div>
</div>
<div id="main">
<div class="top">
    <span class="first">01. 아이디입력</span> > <span class="now">02. 본인 인증</span> > <span>03. 비밀번호 재설정</span> > <span>04. 완료</span><br>
</div>
<p class="findPwText">비밀번호 찾기</p>
<form action="/findPwData02" method="post" name="userinput">
    <p class="name">이름</p> <input type="text" class="inputName" placeholder="이름을 입력해주세요" name="name"><br>
    <p class="font">전화번호</p> <input type="text" class="inputPhone" placeholder="전화번호를 입력해주세요" name="phoneNum"><button class="auth" type="button">인증받기</button><br>
    <input type="text" class="inputAuthNum" placeholder="인증번호를 입력해주세요"><button class="getNumAuth" type="button" >입력</button><br>
    <p th:text="${message}" class="message"></p><br>
    <input type="hidden" name="authed" class="phoneNumAuthCheck" value="">
    <button type="submit" class="btnfindPw" onclick="check()" >다음</button>
</form>
</div>
<input type="hidden" class="googleLogin" th:value="${googleLogin}">
<input type="hidden" class="kakaoLogin" th:value="${kakaoLogin}">

<script>
    $(".auth").click(function () {
        /*var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");*/

        /* 가입하기 눌렀을 때 핸드폰인증 했는지 안했는지 체크 하기위한 변수 */
        var authed = false;

        console.log($('.inputPhone').val());
        alert("인증 번호가 발송되었습니다");
        var data={"name":$('.inputPhone').val()}
        $.ajax({
            url: "/findPwPhone",
            type: "POST",
            data: {"name" : $('.inputPhone').val()},
            /*      contentType: "application/json; charset=utf-8",*/
            /*dataType: "text",*/
            /*      beforeSend : function(xhr){
                      /!*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*!/
                        xhr.setRequestHeader(header, token);
                  },*/
            success: function (result) {
                console.log("success : " + result);
                console.log("data : " + JSON.stringify(data));

            },
            error: function (result) {
                console.log("failed : " + result);

                /*console.log("data : " + JSON.stringify(data));*/
            }
        });
    });

    $(".getNumAuth").click(function () {
        $.ajax({
            type : "GET",
            url : "findPwAuthNum",
            data : {
                authNum : "${authNum}"
            },
            error : function(error) {
                console.log("error");
            },
            success : function(data) {
                console.log("success");
                console.log(data.authNum);
                if($(".inputAuthNum").val() == data.authNum){
                    alert("본인인증이 완료되었습니다.");
                    authed = true;
                }
                else{
                    alert("인증번호가 틀렸습니다.");
                }
            }
        });
    });

    function check(){
        if($('.inputName').val() == null || $('.inputName').val() == ""){
            alert("이름을 입력해주세요");
        }

        if(authed == false){
            alert("핸드폰 본인인증을 통과하셔야합니다.");
            /*$('.phoneNumAuthCheck').setAttribute("value" , "phoneFalse");*/
            document.querySelector('.phoneNumAuthCheck').value = "phoneFalse";
        }else{
            /*$('.phoneNumAuthCheck').setAttribute("value", "phoneTrue");*/
            document.querySelector('.phoneNumAuthCheck').value = "phoneTrue";
        }
    }

    ///////////////////////////////////////////////////////////////////////////

    $('.logoutCheck').click(function () {

        var googleLogin = $('.googleLogin').val();
        var kakaoLogin =  $('.kakaoLogin').val();
        console.log("googleLogin : " + googleLogin);
        console.log("kakaoLogin : " + kakaoLogin);
        if(googleLogin == "true"){
            location.href = "https://www.google.com/accounts/Logout?continue=https://appengine.google.com/_ah/logout?continue=http://localhost:80/snsLogout";
        }
        else if(kakaoLogin == "true"){
            location.href = "https://kauth.kakao.com/oauth/logout?client_id=8a508edf449a39d0fcb2078d37966226&logout_redirect_uri=http://localhost/snsLogout";
        }else{
            // location.href = "/loginForm02";

            $.ajax({
                url : '/logoutForUser',
                type : 'get',
                data : {

                },
                success : function (result) {
                    console.log("로그아웃 요청 성공");
                    console.log("result : " + result);
                    location.href="/loginForm02?retryCheck=no";
                },
                error : function () {
                    console.log("로그아웃 요청 실패");
                }
            });
        }
    });


</script>
</body>
</html>